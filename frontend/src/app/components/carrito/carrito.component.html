<div style="margin-bottom:28px">
  <h1 style="font-size:2rem;font-weight:800;color:#0f172a;letter-spacing:-.03em">Carrito de Compras</h1>
  <div style="width:40px;height:4px;background:#f59e0b;border-radius:2px;margin-top:6px"></div>
</div>

<div *ngIf="(carrito.items$ | async)?.length === 0" class="empty-cart">
  <mat-icon style="font-size:72px;width:72px;height:72px;color:#cbd5e1;display:block;margin:0 auto 16px">shopping_cart</mat-icon>
  <h2>Tu carrito está vacío</h2>
  <p>Explora nuestro catálogo y agrega productos</p>
  <button mat-raised-button color="primary" routerLink="/catalogo" style="margin-top:20px;height:44px">
    <mat-icon>storefront</mat-icon> Ir al Catálogo
  </button>
</div>

<div *ngIf="(carrito.items$ | async)?.length! > 0">
  <mat-table [dataSource]="(carrito.items$ | async)!" class="carrito-tabla">

    <ng-container matColumnDef="producto">
      <mat-header-cell *matHeaderCellDef>Producto</mat-header-cell>
      <mat-cell *matCellDef="let item">
        <div>
          <strong style="color:#0f172a">{{ item.repuesto.nombre }}</strong><br>
          <span class="marca-chip">{{ item.repuesto.marca?.nombre }}</span>
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="precio">
      <mat-header-cell *matHeaderCellDef>Precio</mat-header-cell>
      <mat-cell *matCellDef="let item" style="color:#475569">${{ item.repuesto.precio | number:'1.2-2' }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="cantidad">
      <mat-header-cell *matHeaderCellDef>Cantidad</mat-header-cell>
      <mat-cell *matCellDef="let item">
        <button mat-icon-button (click)="actualizarCantidad(item, -1)">
          <mat-icon>remove</mat-icon>
        </button>
        <span style="min-width:32px;text-align:center;display:inline-block;font-weight:600">{{ item.cantidad }}</span>
        <button mat-icon-button (click)="actualizarCantidad(item, 1)"
                [disabled]="item.cantidad >= item.repuesto.stock">
          <mat-icon>add</mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="subtotal">
      <mat-header-cell *matHeaderCellDef>Subtotal</mat-header-cell>
      <mat-cell *matCellDef="let item" class="precio-tag">
        ${{ (item.repuesto.precio * item.cantidad) | number:'1.2-2' }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="acciones">
      <mat-header-cell *matHeaderCellDef></mat-header-cell>
      <mat-cell *matCellDef="let item">
        <button mat-icon-button color="warn" (click)="eliminar(item)" matTooltip="Eliminar">
          <mat-icon>delete_outline</mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>

  <div class="carrito-resumen">
    <div style="display:flex;justify-content:space-between;margin-bottom:10px;font-size:.95rem;color:#475569">
      <span>Subtotal:</span>
      <strong style="color:#0f172a">${{ carrito.subtotal | number:'1.2-2' }}</strong>
    </div>
    <div style="display:flex;justify-content:space-between;margin-bottom:10px;font-size:.95rem;color:#475569">
      <span>IVA (12%):</span>
      <strong style="color:#0f172a">${{ carrito.iva | number:'1.2-2' }}</strong>
    </div>
    <mat-divider style="margin:14px 0"></mat-divider>
    <div class="total-row" style="display:flex;justify-content:space-between;margin-bottom:24px">
      <span>TOTAL:</span>
      <span>${{ carrito.total | number:'1.2-2' }}</span>
    </div>
    <button mat-raised-button color="primary" style="width:100%;height:48px;font-size:1rem;margin-bottom:10px" (click)="irAlCheckout()">
      <mat-icon>payment</mat-icon> Proceder al pago
    </button>
    <button mat-stroked-button style="width:100%;height:44px" (click)="carrito.vaciar()">
      <mat-icon>remove_shopping_cart</mat-icon> Vaciar carrito
    </button>
  </div>
</div>
