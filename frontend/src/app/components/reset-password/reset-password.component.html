<div class="form-container">
  <mat-card>
    <mat-icon style="display:block;text-align:center;font-size:48px;width:48px;height:48px;margin:0 auto 8px;color:#1565C0">
      lock_open
    </mat-icon>
    <h2 style="text-align:center">Nueva contraseña</h2>

    <div *ngIf="tokenInvalido" style="text-align:center;padding:16px">
      <mat-icon style="font-size:48px;width:48px;height:48px;color:#c62828">error</mat-icon>
      <h3>Enlace inválido</h3>
      <p style="color:#666">Este enlace de recuperación no es válido o ha expirado.</p>
      <button mat-raised-button color="primary" routerLink="/forgot-password">Solicitar nuevo enlace</button>
    </div>

    <div *ngIf="exitoso && !tokenInvalido" style="text-align:center;padding:16px">
      <mat-icon style="font-size:48px;width:48px;height:48px;color:#2e7d32">check_circle</mat-icon>
      <h3>¡Contraseña actualizada!</h3>
      <p style="color:#666">Tu contraseña fue restablecida exitosamente. Redirigiendo al inicio de sesión...</p>
    </div>

    <form *ngIf="!tokenInvalido && !exitoso" [formGroup]="form" (ngSubmit)="restablecer()">
      <mat-form-field class="form-full-width" style="margin-bottom:12px">
        <mat-label>Nueva contraseña</mat-label>
        <input matInput [type]="mostrarPassword ? 'text' : 'password'" formControlName="nuevaPassword">
        <button mat-icon-button matSuffix type="button" (click)="mostrarPassword = !mostrarPassword">
          <mat-icon>{{ mostrarPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="form.get('nuevaPassword')?.hasError('minlength')">Mínimo 6 caracteres</mat-error>
      </mat-form-field>

      <mat-form-field class="form-full-width" style="margin-bottom:24px">
        <mat-label>Confirmar contraseña</mat-label>
        <input matInput type="password" formControlName="confirmarPassword">
        <mat-error *ngIf="form.hasError('noCoinciden')">Las contraseñas no coinciden</mat-error>
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit"
              [disabled]="form.invalid || cargando" style="width:100%">
        <mat-spinner *ngIf="cargando" diameter="20" style="display:inline-block;margin-right:8px"></mat-spinner>
        Restablecer contraseña
      </button>
    </form>
  </mat-card>
</div>
