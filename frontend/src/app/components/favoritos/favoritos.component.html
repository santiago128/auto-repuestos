<h1>Mis Favoritos</h1>

<div *ngIf="cargando" style="text-align:center;padding:40px">
  <mat-spinner diameter="40" style="margin:auto"></mat-spinner>
</div>

<div *ngIf="!cargando && repuestos.length === 0" class="no-results">
  <mat-icon style="font-size:64px;width:64px;height:64px;color:#ddd">favorite_border</mat-icon>
  <h2>No tienes favoritos aún</h2>
  <p>Explora el catálogo y guarda los repuestos que te interesen.</p>
  <button mat-raised-button color="primary" routerLink="/catalogo" style="margin-top:16px">
    Ver Catálogo
  </button>
</div>

<div class="productos-grid" *ngIf="!cargando">
  <mat-card *ngFor="let r of repuestos" class="producto-card" routerLink="/repuesto/{{r.id}}">
    <mat-card-header>
      <mat-card-title>{{ r.nombre }}</mat-card-title>
      <mat-card-subtitle>
        <span class="marca-chip">{{ r.marca?.nombre }}</span>
        <span *ngIf="r.modelo"> · {{ r.modelo?.nombre }}</span>
        <span *ngIf="r.categoria"> · {{ r.categoria?.nombre }}</span>
      </mat-card-subtitle>
    </mat-card-header>
    <img mat-card-image
         [src]="r.imagenUrl || 'assets/repuesto-default.png'"
         [alt]="r.nombre"
         onerror="this.src='assets/repuesto-default.png'">
    <mat-card-content>
      <p style="color:#666;font-size:.85em;margin-bottom:8px">Cód: {{ r.codigo }}</p>
      <p class="precio-tag">${{ r.precio | number:'1.2-2' }}</p>
      <p [class.stock-ok]="r.stock > 5"
         [class.stock-bajo]="r.stock > 0 && r.stock <= 5"
         [class.stock-agotado]="r.stock === 0">
        {{ r.stock > 0 ? 'En stock: ' + r.stock : 'Agotado' }}
      </p>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button color="primary" routerLink="/repuesto/{{r.id}}">Detalle</button>
      <button mat-icon-button color="warn" (click)="toggleFavorito(r, $event)" matTooltip="Quitar de favoritos">
        <mat-icon>favorite</mat-icon>
      </button>
      <button mat-raised-button color="primary"
              [disabled]="r.stock === 0"
              (click)="agregarAlCarrito(r, $event)">
        <mat-icon>add_shopping_cart</mat-icon>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
